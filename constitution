<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indian Constitution — Awareness App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#eef6f9;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0ea5a3; /* teal */
      --accent-2:#334155; /* indigo gray */
      --glass: rgba(255,255,255,0.6);
      --radius:14px;
      --glass-border: rgba(2,6,23,0.06);
      --success:#10b981;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: linear-gradient(180deg,var(--bg),#f7fbfc);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom:40px;
    }

    /* Login / Hero */
    .hero{
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;
      background-image: radial-gradient(circle at 10% 10%, rgba(14,165,163,0.08), transparent 8%), radial-gradient(circle at 90% 90%, rgba(51,65,85,0.04), transparent 10%);
    }
    .auth-card{width:100%;max-width:920px;display:grid;grid-template-columns:1fr 420px;gap:24px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.75));border-radius:18px;padding:18px;box-shadow:0 18px 60px rgba(2,6,23,0.08);align-items:center}
    .brand{padding:28px}
    .brand h1{margin:0;font-size:22px}
    .brand p{margin-top:8px;color:var(--muted)}
    .features{display:grid;gap:8px;margin-top:14px}
    .feature{display:flex;gap:10px;align-items:flex-start}
    .badge{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#34d399);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}

    .login-form{background:linear-gradient(180deg,#fff,#fbfeff);padding:18px;border-radius:12px;border:1px solid var(--glass-border)}
    .login-form h3{margin:0 0 8px}
    .input{display:block;width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef0;margin-top:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 14px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(14,165,163,0.12)}
    .muted{color:var(--muted);font-size:13px}

    /* App shell */
    .app-shell{max-width:1200px;margin:22px auto;padding:0 18px}
    header.app-header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:linear-gradient(90deg, rgba(14,165,163,0.06), rgba(51,65,85,0.02));padding:14px;border-radius:12px}
    .logo{display:flex;gap:12px;align-items:center}
    .logo .square{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#34d399);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    .header-actions{display:flex;align-items:center;gap:10px}
    .role-pill{background:linear-gradient(90deg,#f8fffe,#f0fdf4);padding:8px 10px;border-radius:999px;border:1px solid rgba(14,165,163,0.08)}

    .main{display:grid;grid-template-columns:320px 1fr;gap:20px;margin-top:18px}
    @media (max-width:980px){.main{grid-template-columns:1fr}}

    .sidebar{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 28px rgba(12,17,26,0.04)}
    .role-grid{display:grid;grid-template-columns:1fr;gap:10px}
    .role-card{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;cursor:pointer;transition:transform .18s,box-shadow .18s}
    .role-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(12,17,26,0.06)}
    .role-icon{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#fff,#f0f9ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent-2)}

    .nav-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;margin-top:8px;cursor:pointer;transition:background .12s}
    .nav-item:hover{background:linear-gradient(90deg, rgba(14,165,163,0.04), rgba(51,65,85,0.01))}

    .content{background:var(--card);border-radius:12px;padding:22px;box-shadow:0 18px 48px rgba(12,17,26,0.04)}
    .content h2{margin:0}
    .subtle{color:var(--muted);font-size:13px;margin-top:6px}
    .content-body{margin-top:14px;color:#0f172a;line-height:1.7}
    .hero-image{width:100%;max-height:320px;object-fit:cover;border-radius:10px;margin-top:14px}

    .info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:14px}
    .info-card{background:linear-gradient(180deg,#fff,#fbfeff);border-radius:10px;padding:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}

    /* Quiz UI */
    .quiz-box{padding:14px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#f8fffd);box-shadow:0 12px 34px rgba(12,17,26,0.04)}
    .progress{height:10px;background:#e6eef0;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#34d399);width:0%;transition:width .3s}
    .option{padding:12px;border-radius:10px;border:1px solid #e6eef0;margin-bottom:8px;cursor:pointer;transition:background .12s,transform .12s}
    .option:hover{transform:translateY(-3px)}
    .option.selected{background:linear-gradient(90deg, rgba(14,165,163,0.08), rgba(14,165,163,0.03));border-color:rgba(14,165,163,0.18)}
    .option.correct{background:linear-gradient(90deg,#ecfdf5,#dcfce7);border-color:#12b76a}
    .option.wrong{background:linear-gradient(90deg,#fff1f2,#fee2e2);border-color:#fb7185}

    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    .btn.secondary{background:#334155}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(6,8,15,0.45);display:flex;align-items:center;justify-content:center;z-index:40;opacity:0;pointer-events:none;transition:opacity .18s}
    .modal{width:min(760px,94%);background:var(--card);padding:18px;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.4)}
    .modal-backdrop.show{opacity:1;pointer-events:auto}

    /* Discussion */
    .thread{max-height:220px;overflow:auto;padding:10px;border-radius:10px;border:1px dashed #eef2f7;background:#fbfeff}
    .msg{padding:8px;border-radius:8px;margin-bottom:8px}
    .msg.user{background:linear-gradient(90deg,#ecfeff,#e6fffa)}
    .msg.expert{background:linear-gradient(90deg,#f0f6ff,#eef2ff)}

    footer{max-width:1200px;margin:20px auto;color:var(--muted);font-size:13px;text-align:center}

    /* small responsive tweaks */
    @media (max-width:720px){
      .auth-card{grid-template-columns:1fr}
      .login-form{order:2}
      .brand{order:1}
      .app-shell{padding:0 12px}
    }
  </style>
</head>
<body>

  <!-- LOGIN / HERO -->
  <section class="hero" id="hero">
    <div class="auth-card" role="region" aria-label="Login card">
      <div class="brand">
        <div class="square" style="width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#34d399);display:flex;align-items:center;justify-content:center;color:white;font-weight:800">IC</div>
        <h1>Constitution Awareness Lab</h1>
        <p class="muted">Polished learning platform — quizzes, content, and role-based tools.</p>

        <div class="features">
          <div class="feature"><div class="badge">Q</div><div><strong>Interactive Quizzes</strong><div class="muted">MCQs & Fill-in-the-blanks</div></div></div>
          <div class="feature"><div class="badge" style="background:linear-gradient(135deg,#6366f1,#a78bfa)">C</div><div><strong>Curated Content</strong><div class="muted">Rights, Duties, and Framework with images</div></div></div>
          <div class="feature"><div class="badge" style="background:linear-gradient(135deg,#fb7185,#f97316)">D</div><div><strong>Discussion</strong><div class="muted">Ask experts — local demo thread</div></div></div>
        </div>

        <p class="muted" style="margin-top:14px">Demo accounts: admin/1234 • educator/abcd • citizen/0000 • expert/law</p>
      </div>

      <form class="login-form" id="login-form" onsubmit="event.preventDefault(); login();">
        <h3>Sign in</h3>
        <div class="muted">Use one of the demo accounts above or create your own (stored locally).</div>
        <input id="username" class="input" placeholder="Username" aria-label="username" required>
        <input id="password" class="input" type="password" placeholder="Password" aria-label="password" required>
        <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
          <button class="btn">Sign in</button>
          <button class="btn ghost" type="button" onclick="openRegister()">Register</button>
        </div>
        <p id="login-error" style="color:var(--danger);margin-top:10px"></p>
      </form>
    </div>
  </section>

  <!-- MAIN APP -->
  <div class="app-shell" id="app-shell" style="display:none">
    <header class="app-header">
      <div class="logo">
        <div class="square">IC</div>
        <div>
          <div style="font-weight:700">Constitution Awareness Lab</div>
          <div class="muted">Learn • Test • Discuss</div>
        </div>
      </div>

      <div class="header-actions">
        <div class="role-pill" id="header-role">Role: —</div>
        <button class="btn ghost" id="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
        <div style="display:flex;align-items:center;gap:8px">
          <div id="user-name" style="font-weight:600"></div>
          <button class="btn ghost" onclick="logout()">Logout</button>
        </div>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <div>
            <div style="font-size:13px;color:var(--muted)">Logged in as</div>
            <strong id="role-label">Guest</strong>
          </div>
          <div>
            <button class="btn secondary" onclick="changeRole()">Switch Role</button>
          </div>
        </div>

        <div class="role-grid">
          <div class="role-card" onclick="selectRole('Citizen')">
            <div class="role-icon">C</div>
            <div>
              <strong>Citizen</strong>
              <div class="muted">Explore content and take quizzes</div>
            </div>
          </div>
          <div class="role-card" onclick="selectRole('Educator')">
            <div class="role-icon">E</div>
            <div>
              <strong>Educator</strong>
              <div class="muted">Add quiz items and guide learners</div>
            </div>
          </div>
          <div class="role-card" onclick="selectRole('Legal Expert')">
            <div class="role-icon">L</div>
            <div>
              <strong>Legal Expert</strong>
              <div class="muted">Post expert notes in discussions</div>
            </div>
          </div>
          <div class="role-card" onclick="selectRole('Admin')">
            <div class="role-icon">A</div>
            <div>
              <strong>Admin</strong>
              <div class="muted">Manage content & moderate</div>
            </div>
          </div>
        </div>

        <nav style="margin-top:16px">
          <div class="nav-item" onclick="showTopic('rights')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2L2 7l10 5 10-5-10-5z" stroke="#0ea5a3" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div>
              <strong>Fundamental Rights</strong>
              <div class="muted">Key articles & explanations</div>
            </div>
          </div>
          <div class="nav-item" onclick="showTopic('duties')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="#fb7185" stroke-width="1.2" stroke-linecap="round"/></svg>
            <div>
              <strong>Fundamental Duties</strong>
              <div class="muted">Responsibilities of citizens</div>
            </div>
          </div>
          <div class="nav-item" onclick="showTopic('framework')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 7h18M3 12h18M3 17h18" stroke="#6366f1" stroke-width="1.2" stroke-linecap="round"/></svg>
            <div>
              <strong>Framework</strong>
              <div class="muted">Parts, Articles & Schedules</div>
            </div>
          </div>
          <div class="nav-item" onclick="startQuiz()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="#06b6d4" stroke-width="1.2" stroke-linecap="round"/></svg>
            <div>
              <strong>Quizzes</strong>
              <div class="muted">MCQs & Fill-in-the-blanks</div>
            </div>
          </div>
          <div class="nav-item" onclick="openDiscussion()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2z" stroke="#fb923c" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div>
              <strong>Discussion</strong>
              <div class="muted">Ask questions — demo thread</div>
            </div>
          </div>
        </nav>
      </aside>

      <section class="content" id="content-area">
        <div>
          <h2 id="content-title">Welcome</h2>
          <div class="subtle" id="content-sub">Select a topic from the left to begin</div>
        </div>

        <div class="content-body" id="content-body">
          <p class="muted">This expert-style interface contains detailed topic pages, a refined quiz engine supporting MCQs and fill-in-the-blanks, plus tools for Educators and Legal Experts. Everything runs client-side and persists locally.</p>
          <img src="https://upload.wikimedia.org/wikipedia/commons/1/1e/Constitution_of_India.jpg" alt="Constitution" class="hero-image">

          <div class="info-grid">
            <div class="info-card"><strong>Professional UI</strong><p class="muted">Glass-like cards, subtle gradients, and consistent spacing make the app look production-ready.</p></div>
            <div class="info-card"><strong>Role-aware</strong><p class="muted">Different capabilities for Citizens, Educators, Experts, and Admins.</p></div>
            <div class="info-card"><strong>Local-first</strong><p class="muted">Quiz items and discussion are stored in localStorage for quick demos.</p></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      Built for demo • Single-file app • No backend required
    </footer>
  </div>

  <!-- RESULT MODAL -->
  <div id="result-modal" class="modal-backdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <h3 id="result-title">Your quiz result</h3>
      <div id="result-details" style="margin-top:10px;color:var(--muted)"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn secondary" onclick="closeResult()">Close</button>
        <button class="btn" onclick="retryQuiz()">Retry</button>
      </div>
    </div>
  </div>

  <!-- ADD QUESTION MODAL -->
  <div id="add-modal" class="modal-backdrop">
    <div class="modal">
      <h3>Add a quiz question</h3>
      <div style="margin-top:10px">
        <label>Type</label><br>
        <select id="new-type" style="padding:8px;border-radius:8px;margin-top:6px">
          <option value="mcq">MCQ</option>
          <option value="fill">Fill in the blank</option>
        </select>
      </div>
      <div style="margin-top:10px">
        <label>Question</label><br>
        <input id="new-question" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef0;margin-top:6px">
      </div>
      <div id="mcq-area" style="margin-top:10px">
        <label>Options (comma-separated)</label><br>
        <input id="new-options" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef0;margin-top:6px" placeholder="Option1, Option2, Option3">
        <small style="color:var(--muted)">Provide the correct answer exactly as one of the options below.</small>
      </div>
      <div style="margin-top:10px">
        <label>Answer</label><br>
        <input id="new-answer" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef0;margin-top:6px">
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn secondary" onclick="closeAddModal()">Cancel</button>
        <button class="btn" onclick="addQuestion()">Add</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== sample content & quiz data ===== */
    const SAMPLE = {
      rights: {
        title: 'Fundamental Rights',
        subtitle: 'Part III of the Constitution — Core civil liberties',
        image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Fundamental_Rights_in_Indian_Constitution.png/640px-Fundamental_Rights_in_Indian_Constitution.png',
        paragraphs:[
          'Fundamental Rights are enshrined in Part III (Articles 12–35) of the Constitution. They protect individual liberties against arbitrary state action.',
          'Key rights include: Right to Equality (Articles 14–18), Right to Freedom (Article 19), Right against Exploitation (Articles 23–24), Right to Freedom of Religion (Articles 25–28), Cultural and Educational Rights (Articles 29–30), and Right to Constitutional Remedies (Article 32).',
          'These rights are justiciable — citizens may approach the judiciary if they are violated.'
        ]
      },
      duties: {
        title: 'Fundamental Duties',
        subtitle: 'Added by the 42nd Amendment (Article 51A)',
        image: 'https://static.pib.gov.in/WriteReadData/userfiles/image/fundamental%20duties%20englishU6BR.jpg',
        paragraphs:[
          'Fundamental Duties are moral obligations for citizens. They were added in 1976 and list responsibilities such as respecting the Constitution, promoting harmony, and protecting the environment.',
          'There are 11 duties, including respecting national symbols, preserving heritage, and striving for excellence in all spheres of individual and collective activity.',
          'Fundamental Duties are not enforceable by law in the same way as Fundamental Rights, but they provide a framework for civic consciousness.'
        ]
      },
      framework: {
        title: 'Framework of the Constitution',
        subtitle: 'Long-form written Constitution — federal structure with unitary features',
        image: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Constitution_of_India.jpg',
        paragraphs:[
          'The Constitution is the supreme law of India. It defines the political principles, the structure, powers, and duties of government institutions, and sets out fundamental rights and duties.',
          'It is divided into Parts, Articles, and Schedules; it balances federalism with a strong central authority and contains provisions for amendment (Article 368).',
          'The Constitution draws inspiration from many sources, incorporating best practices while fitting India’s unique social and historical context.'
        ]
      }
    };

    const DEFAULT_QUIZ = [
      {type:'mcq',question:'How many Fundamental Duties are listed in the Constitution?',options:['8','10','11','12'],answer:'11',explain:'11 duties were added by the 42nd Amendment.'},
      {type:'mcq',question:'Which Article guarantees equality before law?',options:['Article 12','Article 13','Article 14','Article 15'],answer:'Article 14',explain:'Article 14 ensures equality before the law and equal protection of laws.'},
      {type:'fill',question:'The Constitution of India came into effect on _______.',answer:'26 January 1950',explain:'Republic Day — 26 January 1950.'},
      {type:'mcq',question:'Part III of the Constitution contains which of the following?',options:['Directive Principles','Fundamental Rights','Emergency Provisions','Schedules'],answer:'Fundamental Rights',explain:'Part III is dedicated to Fundamental Rights.'},
      {type:'fill',question:'The Directive Principles of State Policy are contained in Part ___ of the Constitution.',answer:'IV',explain:'Directive Principles are in Part IV.'}
    ];

    /* ===== demo users (local) ===== */
    const DEMO_USERS = {
      admin:{password:'1234',role:'Admin',name:'Administrator'},
      educator:{password:'abcd',role:'Educator',name:'Educator'},
      citizen:{password:'0000',role:'Citizen',name:'Citizen'},
      expert:{password:'law',role:'Legal Expert',name:'Legal Expert'}
    };

    /* ===== stateful app ===== */
    const app = {
      user:null,
      role:null,
      quiz:null,
      currentQ:0,
      answers:{},

      init(){
        // load from localStorage
        const savedQuiz = localStorage.getItem('constitution_quiz');
        this.quiz = savedQuiz ? JSON.parse(savedQuiz) : DEFAULT_QUIZ.slice();
        // hide modals
        document.getElementById('result-modal').classList.remove('show');
        document.getElementById('add-modal').classList.remove('show');

        // try to resume session
        const session = JSON.parse(localStorage.getItem('constitution_session') || 'null');
        if(session && session.user){
          this.login(session.user);
        }
      },

      register(user,pass,role){
        // store in local demo users map
        DEMO_USERS[user] = {password:pass,role, name:role};
        alert('Registered locally. Use credentials to sign in.');
      },

      login(username){
        // if username is an object (session), use it
        if(typeof username === 'object'){
          this.user = username;
        } else {
          const uname = username || document.getElementById('username').value.trim();
          const pass = document.getElementById('password') ? document.getElementById('password').value.trim() : '';

          // check demo users then local storage users
          const demo = DEMO_USERS[uname.toLowerCase()];
          if(demo && demo.password === pass){
            this.user = {username:uname,role:demo.role,name:demo.name};
          } else {
            // try local registered users
            const localUsers = JSON.parse(localStorage.getItem('local_users') || '{}');
            if(localUsers[uname] && localUsers[uname].password === pass){
              this.user = {username:uname,role:localUsers[uname].role,name:localUsers[uname].name};
            } else {
              document.getElementById('login-error').innerText = 'Invalid credentials.';
              return;
            }
          }
        }

        // set UI
        document.getElementById('hero').style.display='none';
        document.getElementById('app-shell').style.display='block';
        document.getElementById('role-label').innerText = this.user.role;
        document.getElementById('header-role').innerText = this.user.role;
        document.getElementById('user-name').innerText = this.user.name;
        localStorage.setItem('constitution_session', JSON.stringify({user:this.user}));

        // show welcome
        this.showWelcome();
      },

      logout(){
        localStorage.removeItem('constitution_session');
        location.reload();
      },

      showWelcome(){
        document.getElementById('content-title').innerText = 'Welcome — ' + this.user.role;
        document.getElementById('content-sub').innerText = 'Pick a topic from the left. As ' + this.user.role + ', your options may vary.';
        document.getElementById('content-body').innerHTML = `<p class=\"muted\">Welcome back, <strong>${this.user.name}</strong>. Use the left navigation to open content, take quizzes, or join discussions.</p><img src=\"https://upload.wikimedia.org/wikipedia/commons/1/1e/Constitution_of_India.jpg\" class=\"hero-image\" alt=\"Constitution\">`;
      },

      openRegister(){
        const username = prompt('Choose a username (local only)');
        if(!username) return;
        const password = prompt('Choose a password');
        if(!password) return;
        const role = prompt('Role (Citizen / Educator / Legal Expert / Admin)') || 'Citizen';
        const localUsers = JSON.parse(localStorage.getItem('local_users') || '{}');
        localUsers[username] = {password,role,name:username};
        localStorage.setItem('local_users', JSON.stringify(localUsers));
        alert('Registered locally. Now sign in.');
      },

      selectRole(role){
        this.role = role;
        document.getElementById('content-title').innerText = role;
        document.getElementById('content-sub').innerText = 'Choose from the topics or try a quiz.';
        this.showTopic(role === 'Citizen' ? 'rights' : 'rights');
      },

      changeRole(){
        // show the sidebar role cards by scrolling to top
        window.scrollTo({top:0,behavior:'smooth'});
      },

      showTopic(topic){
        const data = SAMPLE[topic];
        if(!data) return;
        document.getElementById('content-title').innerText = data.title;
        document.getElementById('content-sub').innerText = data.subtitle;
        let html = '';
        data.paragraphs.forEach(p=> html += `<p>${p}</p>`);
        html += `<img src=\"${data.image}\" alt=\"${data.title}\" class=\"hero-image\"/>`;
        html += `<div style=\"margin-top:12px\">`;
        if(topic==='rights'){
          html += `<ul class=\"muted\"><li>Right to Equality (Articles 14–18)</li><li>Right to Freedom (Article 19)</li><li>Right against Exploitation (Articles 23–24)</li><li>Right to Constitutional Remedies (Article 32)</li></ul>`;
        } else if(topic==='duties'){
          html += `<ul class=\"muted\"><li>Respect the Constitution</li><li>Protect public property</li><li>Promote harmony</li><li>Preserve the environment</li></ul>`;
        } else if(topic==='framework'){
          html += `<ul class=\"muted\"><li>Parts, Articles & Schedules</li><li>Amendment procedure (Article 368)</li><li>Balance between Union and States</li></ul>`;
        }
        html += `</div>`;
        if(this.user.role === 'Legal Expert'){
          html += `<div style=\"margin-top:14px;padding:12px;border-radius:10px;background:#f8fafc\"><strong>Expert note:</strong> Add authoritative clarifications in the discussion panel.</div>`;
        }
        document.getElementById('content-body').innerHTML = html;
      },

      startQuiz(){
        this.currentQ = 0; this.answers = {};
        document.getElementById('content-title').innerText = 'Quiz — Test your knowledge';
        document.getElementById('content-sub').innerText = 'Multiple questions: MCQs & Fill-the-blank. Progress is saved locally.';
        this.renderQuestion();
      },

      renderQuestion(){
        const q = this.quiz[this.currentQ];
        const total = this.quiz.length;
        const pct = Math.round((this.currentQ/total)*100);
        let body = `\n          <div class=\"quiz-box\">\n            <div style=\"display:flex;justify-content:space-between;align-items:center\"><div><strong>Q${this.currentQ+1} of ${total}</strong></div><div style=\"font-size:13px;color:var(--muted)\">${q.type.toUpperCase()}</div></div>\n            <div style=\"margin-top:10px\"><p style=\"font-weight:600\">${q.question}</p></div>\n            <div style=\"margin-top:12px\" id=\"q-area\">\n            </div>\n            <div style=\"margin-top:10px\">\n              <div class=\"progress\"><i style=\"width:${pct}%\"></i></div>\n            </div>\n            <div class=\"controls\">\n              <button class=\"btn secondary\" onclick=\"prevQ()\" ${this.currentQ===0? 'disabled': ''}>Previous</button>\n              <button class=\"btn\" onclick=\"nextQ()\">${this.currentQ===total-1? 'Finish': 'Next'}</button>\n              <div style=\"margin-left:auto;display:flex;gap:8px;align-items:center\">\n                <button class=\"btn\" onclick=\"openAddModal()\" title=\"Add question (Educator)\">Add Question</button>\n                <button class=\"btn secondary\" onclick=\"openDiscussion()\">Discussion</button>\n              </div>\n            </div>\n          </div>\n        `;
        document.getElementById('content-body').innerHTML = body;

        const area = document.getElementById('q-area');
        if(q.type==='mcq'){
          q.options.forEach((opt,idx)=>{
            const div = document.createElement('div');
            div.className = 'option';
            div.innerText = opt;
            if(this.answers[this.currentQ] === opt) div.classList.add('selected');
            div.onclick = ()=>{
              this.answers[this.currentQ] = opt;
              document.querySelectorAll('#q-area .option').forEach(el=>el.classList.remove('selected'));
              div.classList.add('selected');
              localStorage.setItem('constitution_answers', JSON.stringify(this.answers));
            };
            area.appendChild(div);
          });
        } else if(q.type==='fill'){
          const input = document.createElement('input');
          input.type='text'; input.style.padding='10px'; input.style.width='100%'; input.value = this.answers[this.currentQ] || '';
          input.oninput = ()=>{ this.answers[this.currentQ] = input.value; localStorage.setItem('constitution_answers', JSON.stringify(this.answers)); };
          area.appendChild(input);
        }
      },

      nextQ(){ if(this.currentQ < this.quiz.length - 1){ this.currentQ++; this.renderQuestion(); } else { this.submitQuiz(); } },
      prevQ(){ if(this.currentQ>0){ this.currentQ--; this.renderQuestion(); } },

      submitQuiz(){
        let score = 0; const results = [];
        this.quiz.forEach((q,i)=>{
          const user = (this.answers[i] || '').toString().trim();
          let correct = false;
          if(q.type==='mcq') correct = (user === q.answer);
          else correct = (user.toLowerCase() === q.answer.toLowerCase());
          if(correct) score++;
          results.push({q:q.question, type:q.type, user, correct, correctAnswer:q.answer, explain:q.explain||''});
        });
        document.getElementById('result-title').innerText = `You scored ${score} / ${this.quiz.length}`;
        let details = `<p style=\"color:var(--muted)\">Review:</p><div style=\"margin-top:8px\">`;
        results.forEach((r,idx)=>{
          details += `<div style=\"padding:8px;border-radius:8px;margin-bottom:8px;background:${r.correct? '#f0fff9':'#fff5f5'}\"><strong>Q${idx+1}</strong>: ${r.q}<div style=\"color:var(--muted);margin-top:6px\">Your answer: <b>${r.user || '<i>no answer</i>'}</b> — Correct: <b>${r.correctAnswer}</b><div style=\"margin-top:6px;color:var(--muted)\">${r.explain}</div></div></div>`;
        });
        details += `</div>`;
        document.getElementById('result-details').innerHTML = details;
        openResult();
      },

      openResult(){ const mod = document.getElementById('result-modal'); mod.classList.add('show'); mod.style.display='flex'; },
      closeResult(){ const mod = document.getElementById('result-modal'); mod.classList.remove('show'); mod.style.display='none'; },
      retryQuiz(){ this.answers = {}; localStorage.removeItem('constitution_answers'); this.currentQ=0; closeResult(); this.renderQuestion(); },

      openAddModal(){ if(this.user.role !== 'Educator'){ alert('Only Educators can add questions locally.'); return;} const md = document.getElementById('add-modal'); md.style.display='flex'; md.classList.add('show'); },
      closeAddModal(){ const md = document.getElementById('add-modal'); md.classList.remove('show'); md.style.display='none'; },
      addQuestion(){
        const type = document.getElementById('new-type').value;
        const question = document.getElementById('new-question').value.trim();
        const options = document.getElementById('new-options').value.trim();
        const answer = document.getElementById('new-answer').value.trim();
        if(!question || !answer){ alert('Please provide both question and answer.'); return; }
        const item = {type,question,answer};
        if(type==='mcq'){
          if(!options){ alert('Provide comma-separated options for MCQ.'); return; }
          item.options = options.split(',').map(s=>s.trim());
        }
        this.quiz.push(item);
        localStorage.setItem('constitution_quiz', JSON.stringify(this.quiz));
        alert('Question added locally ✅');
        this.closeAddModal();
      },

      openDiscussion(){
        const html = `\n          <div style=\"margin-top:12px\">\n            <div style=\"display:flex;gap:8px\"><div style=\"flex:1\"><strong>Discussion</strong><div style=\"color:var(--muted);font-size:13px;margin-top:6px\">Ask a question — experts and citizens can post replies (local demo).</div></div></div>\n            <div style=\"margin-top:10px\" class=\"thread\" id=\"thread-area\"></div>\n            <div style=\"display:flex;gap:8px;margin-top:10px\">\n              <input id=\"thread-input\" placeholder=\"Type your question or reply...\" style=\"flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef0\">\n              <button class=\"btn\" onclick=\"postMessage()\">Send</button>\n            </div>\n          </div>\n        `;
        document.getElementById('content-body').innerHTML = html;
        this.renderThread();
      },

      renderThread(){
        const area = document.getElementById('thread-area'); area.innerHTML='';
        const items = JSON.parse(localStorage.getItem('constitution_thread') || '[]');
        items.forEach(it=>{
          const div = document.createElement('div'); div.className='msg ' + (it.role === 'Legal Expert'? 'expert': 'user'); div.innerHTML = `<div style=\"font-size:12px;color:var(--muted)\">${it.role}</div><div style=\"margin-top:6px\">${it.text}</div>`; area.appendChild(div);
        });
      },

      postMessage(){
        const inp = document.getElementById('thread-input'); if(!inp) return;
        const text = inp.value.trim(); if(!text) return; inp.value='';
        const items = JSON.parse(localStorage.getItem('constitution_thread') || '[]');
        items.push({role:this.user.role || 'Citizen',text,ts:Date.now()});
        localStorage.setItem('constitution_thread', JSON.stringify(items));
        this.renderThread();
      }
    };

    /* ===== helpers ===== */
    function login(){
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value.trim();
      const demo = DEMO_USERS[user.toLowerCase()];
      if(demo && demo.password === pass){ app.login(user.toLowerCase()); return; }
      // try local users
      const localUsers = JSON.parse(localStorage.getItem('local_users') || '{}');
      if(localUsers[user] && localUsers[user].password === pass){ app.login({username:user,role:localUsers[user].role,name:localUsers[user].name}); return; }
      document.getElementById('login-error').innerText = 'Invalid credentials.';
    }

    function openRegister(){
      const username = prompt('Choose a username (local only)');
      if(!username) return;
      const password = prompt('Choose a password');
      if(!password) return;
      const role = prompt('Role (Citizen / Educator / Legal Expert / Admin)') || 'Citizen';
      const localUsers = JSON.parse(localStorage.getItem('local_users') || '{}');
      localUsers[username] = {password,role,name:username};
      localStorage.setItem('local_users', JSON.stringify(localUsers));
      alert('Registered locally. Now sign in.');
    }

    function selectRole(role){ app.selectRole(role); }
    function showTopic(topic){ app.showTopic(topic); }
    function startQuiz(){ app.startQuiz(); }
    function prevQ(){ app.prevQ(); }
    function nextQ(){ app.nextQ(); }
    function submitQuiz(){ app.submitQuiz(); }
    function openAddModal(){ app.openAddModal(); }
    function closeAddModal(){ app.closeAddModal(); }
    function addQuestion(){ app.addQuestion(); }
    function openDiscussion(){ app.openDiscussion(); }
    function postMessage(){ app.postMessage(); }
    function closeResult(){ app.closeResult(); }
    function retryQuiz(){ app.retryQuiz(); }
    function logout(){ app.logout(); }
    function changeRole(){ app.changeRole(); }

    function toggleTheme(){
      // simple theme toggle — invert colors for a dark feel
      if(document.body.style.background.indexOf('#0f172a')===-1){
        document.documentElement.style.setProperty('--bg','#091127');
        document.documentElement.style.setProperty('--card','#071029');
        document.documentElement.style.setProperty('--muted','#9aa6b2');
        document.documentElement.style.setProperty('--accent','#06b6d4');
        document.documentElement.style.setProperty('--accent-2','#e6eef8');
        document.documentElement.style.setProperty('--glass','rgba(255,255,255,0.04)');
        document.body.style.background = 'linear-gradient(180deg,#071029,#031025)';
      } else {
        document.documentElement.style.setProperty('--bg','#eef6f9');
        document.documentElement.style.setProperty('--card','#ffffff');
        document.documentElement.style.setProperty('--muted','#6b7280');
        document.documentElement.style.setProperty('--accent','#0ea5a3');
        document.documentElement.style.setProperty('--accent-2','#334155');
        document.body.style.background = 'linear-gradient(180deg,var(--bg),#f7fbfc)';
      }
    }

    function openResult(){ app.openResult(); }

    // initialize
    app.init();
  </script>
</body>
</html>
